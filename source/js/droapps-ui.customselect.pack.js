/*
 * Droapps Custom Select
 * Creates a skinned version of a select tag form
 *
 * Version
 *   0.9
 *
 * Author:
 *   Diego Tres /// D3
 *
 * Contact:
 *   me@diegotres.com
 * 
 * Dual licensed under the MIT and GPL licenses.
 *
 * Depends:
 *   jquery.ui.core.js
 *   jquery.ui.widget.js
 */
(function(a){a.widget("droapps-ui.customselect",{options:{value:0,text:"",visible:"auto",position:"bottom",duration:300,classname:"",selected_class:"selected",open:null,close:null},_create:function(){var b=this;this.element_width=this.element.outerWidth(true);this.element.addClass("droapps-ui-customselect-skinned");this.options.disabled=this.element.is(":disabled");this.items=a("option",this.element);this.selected_item=a(":selected",this.element);this.skinned=a('<dl class="droapps-ui-customselect ui-widget ui-widget-content ui-corner-all"><dt class="droapps-ui-customselect-value droapps-ui-customselect-handler" /><dd class="droapps-ui-customselect-holder-list"><ul class="droapps-ui-customselect-holder-items" /></dd></dl>');this.skinned.addClass(function(){return[b.options.classname,b.options.position].join(" ");});this.doc_body=a("body");this.handler=a(".droapps-ui-customselect-handler",this.skinned);this.holder_list=a(".droapps-ui-customselect-holder-list",this.skinned);this.holder_items=a(".droapps-ui-customselect-holder-items",this.skinned);this._feed();this.items=a(".droapps-ui-customselect-item",this.holder_items);this._bind();this._render();this._fixHeight();this._setOption("disabled",this.options.disabled);},_feed:function(){var b=this,e=this.selected_item.attr("rel")||this.options.value,d=this.holder_items,c;this.handler.text(this.selected_item.text()||this.options.text);this.items.each(function(f,g){c=e==a(g).val()?b.options.selected_class:"";d.append('<li><a class="droapps-ui-customselect-item '+c+'"rel="'+a(g).val()+'" href="#">'+a(g).text()+"</a></li>");});},_bind:function(){var b=this;this.doc_body.bind("click.select",a.proxy(this._close,this));this.skinned.bind("click.select",function(c){c.stopPropagation();});this.handler.bind("click.select",function(c){if(b.options.disabled){return;}b._toggle(c);});this.holder_items.bind("click.select",function(c){if(b.options.disabled){return;}b._toggle(c);});this.items.bind("click.select-setvalues",function(c){c.preventDefault();c.stopPropagation();if(b.options.disabled){return;}b.value({value:a(c.currentTarget).attr("rel"),label:a(c.currentTarget).text()});});},_render:function(){this.skinned.fadeTo(0,0).insertAfter(this.element);var b=this.skinned.outerWidth(true);var c=b>this.element_width?b:this.element_width;var d=this.options.position;this.skinned.width(c||"auto");switch(d){case"top":case"up":this.holder_list.css({top:"auto",bottom:this.handler.outerHeight(true)||0});break;case"middle":case"center":this.holder_list.css({top:this.handler.outerHeight(true)/2,bottom:"auto"});break;case"bottom":case"down":this.holder_list.css({top:this.handler.outerHeight(true),bottom:"auto"});break;default:this.holder_list.css({top:this.handler.outerHeight(true),bottom:"auto"});}this.height_items=this.items.not("."+this.options.selected_class).first().parent().outerHeight(true);this.skinned.fadeTo(0,1);this.holder_list.hide();},_fixHeight:function(){if(typeof this.options.visible==="number"&&this.items.length>this.options.visible){this.holder_list_height=this.height_items*this.options.visible;this.holder_items.height(this.holder_list_height).css({overflowY:"auto",overflowX:"hidden"});}else{this.holder_list_height=0;this.holder_items.height("auto").css({overflow:"hidden"});}},_toggle:function(b){b.stopPropagation();b.preventDefault();if(this.holder_list.is(":visible")){this._close(b);}else{this._open(b);}},_open:function(d){var b=this,c=this.options.context?this.options.context:this.skinned;if(this.holder_list.not(":visible")){if(this.options.position=="middle"||this.options.position=="center"){this.holder_list.height(0).css({display:"block"}).animate({top:-this.holder_list_height/2+this.handler.outerHeight(true)/2,height:this.holder_list_height},this.options.duration,function(){if(b.options.open){b.options.open.apply(c,arguments);}});}else{this.holder_list.slideDown(this.options.duration,function(){if(b.options.open){b.options.open.apply(c,arguments);}});}}},_close:function(d){var b=this,c=this.options.context?this.options.context:this.skinned;if(this.holder_list.is(":visible")){if(this.options.position=="middle"||this.options.position=="center"){this.holder_list.animate({top:this.handler.outerHeight(true)/2,height:0},this.options.duration,function(){a(this).height(0).css({display:"none"});if(b.options.close){b.options.close.apply(c,arguments);}});}else{this.holder_list.css({overflow:"hidden"}).slideUp(this.options.duration,function(){if(b.options.close){b.options.close.apply(c,arguments);}});}}},destroy:function(){this.element.removeClass("droapps-ui-customselect-skinned");this.skinned.remove();a.Widget.prototype.destroy.apply(this,arguments);},value:function(c){var d=c.value||this.options.value,b=c.label||this.options.text;this.items.removeClass(this.options.selected_class).filter("[rel="+d+"]").addClass(this.options.selected_class);this.element.val(d);this.handler.text(b);this._close();if(c===undefined){return this._value();}this._setOption("value",d);return this;},_setOption:function(b,c){a.Widget.prototype._setOption.apply(this,arguments);switch(b){case"value":this.options.value=c;this.element.trigger("change");this._trigger("change",null,c);break;case"disabled":this.skinned[c?"addClass":"removeClass"]("disabled");break;}},_value:function(){return this.options.value;},widget:function(){return this.skinned||this.element;}});})(jQuery);